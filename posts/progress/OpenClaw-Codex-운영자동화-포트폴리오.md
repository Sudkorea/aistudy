# OpenClaw + Codex 운영자동화 포트폴리오 (Discord 기반)

## 0) 프로젝트 목적
핸드폰(Discord)에서 VSCode Codex 확장과 유사한 개발 경험을 재현하되,
OpenClaw의 강점(멀티 에이전트, cron, 채널/계정 라우팅, 운영 자동화)을 결합해
**실행 가능한 자동화 에이전트 운영 체계**를 구축하는 것이 목표였다.

---

## 1) 구현 범위 요약

### A. Discord 라우팅/활성화 제어
- 채널 단위 `requireMention` 정책을 제어해 에이전트 반응 조건 분리
- 최종적으로 특정 채널에서 **Caine만 no-mention 응답**, 타 계정은 제한
- 멀티 계정(`caine`, `gigachad`, `bubbles`)별 channel override 적용

### B. SOXL 감시 자동화 (Bubbles 계정 전송)
- 스크립트: `workspace-caine-agent/scripts/soxl_alert_bot.py`
- 기능:
  - 개장/마감 감지
  - 5분 단위 변동 모니터링
  - 급등/급락 이벤트 감지
  - 변동 원인 추론(섹터/금리/변동성 proxy)
  - 관련 뉴스 요약
- Discord 전송: `bubbles` 계정으로 지정 채널 자동 게시
- cron 작업으로 주기 실행

### C. Private 지식의 RAG 안전화 (2+1 전략)
- 원본 private vault와 분리된 `rag-safe` 작업 트리 구성
- 마스킹 파이프라인 구축:
  - 스크립트: `workspace-caine-agent/scripts/sanitize_obsidian_for_rag.py`
  - PII 패턴(연락처/이메일/주소/토큰 등) 치환
  - 불필요 개인성 노트 경로 제외
- RAG 소스 정책 분리:
  - `memory/rag_sources.json`
  - 허용: `aistudy + obsidian-vault-rag-safe`
  - 차단: raw `obsidian-vault`
- 정기 sanitize cron 등록

### D. 안정성 강화를 위한 운영 규칙
- `CLAUDE.md` + `AGENTS.md`에 코딩 행동강령 반영
- Codex-safe 기본 모드 도입:
  1. 짧은 계획 제시
  2. 고위험 작업 사전 확인
  3. 최소 변경 원칙
  4. 검증 후 보고
  5. 롤백 경로 명시
- 체크리스트 문서화: `CODEX_SAFE_CHECKLIST.md`

---

## 2) 아키텍처 관점 성과

### 강점
1. **채팅 기반 실행 자동화**
   - 파일 수정, shell 실행, cron, 메시징까지 단일 루프에서 처리 가능
2. **멀티 계정/멀티 에이전트 제어**
   - Discord 계정별 정책 오버라이드 가능
3. **데이터 경계 분리**
   - private raw와 rag-safe를 구조적으로 분리해 리스크 완화

### 한계/리스크
1. 정책 파일은 규약에 가깝고, 강제 샌드박스가 아님
2. 설정 변경 시 전역 영향(권한 과확장) 위험 존재
3. 무심한 자동화는 로그/메시지 경로로 민감정보 유출 위험

---

## 3) 시행착오와 교훈

### 문제
- 초기 설정 변경에서 의도보다 넓은 범위(다중 봇/채널)에 영향이 발생

### 원인
- 목표 충족만 빠르게 맞추고, 제약 조건(다른 계정 영향 금지) 검증이 약했음

### 개선
- 계정/채널 단위의 명시적 검증 루틴 도입
- 적용 후 side-effect 확인
- 롤백 가능 경로를 작업 보고에 포함

---

## 4) 실전 운영 지침 (요약)
1. 변경 전: 성공 조건/영향 범위/롤백 정의
2. 변경 중: 최소 패치 + 고위험 작업 전 승인
3. 변경 후: 기능검증 + 부작용검증 + 롤백문구 기록

---

## 5) 다음 확장 아이디어
1. **Solver/Critic/Judge 파이프라인**
   - 설정 변경을 제안-비평-판정 구조로 자동화해 과확장 방지
2. **검증기 자동화**
   - “의도한 계정만 no-mention인가?” 같은 정책 검증 스크립트화
3. **RAG 품질 개선**
   - rag-safe 인덱싱 품질 지표(누락률/과마스킹률) 측정

---

## 6) 한 줄 결론
OpenClaw는 단순 챗봇이 아니라 **운영 가능한 실행 런타임**이고,
Codex 스타일의 작업 원칙(계획-검증-롤백)을 결합하면
핸드폰 기반 개발/운영 에이전트로 실전 사용이 가능하다.
