![[[MLforRecSys] (9강) 인과성과 기계학습 I.pdf]]

# 인과성 개요

## 인과성(Causality)

개념이 뭔진 잘 알아서 멀 쓸지 감이 안잡힘

### **Average Treatment Effect (ATE)와 Conditional Average Treatment Effect (CATE) 개념 설명**

✅ **1. Average Treatment Effect (ATE)**

- ATE는 **처치(treatment)의 평균적인 효과**를 측정하는 값이다.
- 보통 처치 집단과 통제 집단 간의 **평균적인 결과 차이**를 나타냄.
- 실험이나 관찰 연구에서 특정 개입(예: 약물, 마케팅 캠페인)이 전체 모집단에 미치는 평균적인 영향을 측정하는 데 사용됨.

🔹 **수식 표현**

$$ATE = E[Y(1)] - E[Y(0)]$$

- $E[Y(1)]$: 처치를 받은 경우의 기대 결과
- $E[Y(0)]$: 처치를 받지 않은 경우의 기대 결과

✅ **2. Conditional Average Treatment Effect (CATE)**

- CATE는 ATE와 비슷하지만, 특정 조건(특정 그룹 또는 개별 특성)에 따라 달라지는 **개별적인 처치 효과**를 측정함.
- 예를 들어, 특정 연령대, 성별, 소득 수준을 고려했을 때 **처치의 효과가 어떻게 달라지는지** 분석하는 것.

🔹 **수식 표현**

$$CATE(x) = E[Y(1) | X = x] - E[Y(0) | X = x]$$

- $X  = x$ : 특정 조건(예: 특정 연령대, 성별, 지역 등)에 해당하는 경우의 기대 효과

✅ **차이점**



|  |**ATE**|**CATE**|
|---|---|---|
|정의|전체 모집단의 평균적인 처치 효과|특정 그룹 또는 개별 특성에 따른 처치 효과|
|적용 범위|모집단 전체|부분집단 또는 개별 수준|
|활용 예시|신약의 평균 효과 분석|특정 연령대별 신약 효과 분석|

---

### **중요한 질문 선정 (5가지 접근법 중 선별)**

📌 **1. "내가 교수라면" 접근법**

- ATE와 CATE의 차이를 **하나의 직관적인 비유**로 설명한다면 어떻게 할 수 있을까?

📌 **2. "실전 적용" 접근법**

- 온라인 광고 캠페인에서 ATE와 CATE를 활용하여 효과적인 타겟팅 전략을 수립하려면 어떻게 해야 할까?

📌 **3. "반대의 관점" 접근법**

- ATE만 사용하고 CATE를 고려하지 않는다면 어떤 문제점이 발생할까?
- 
## **Neural Network and Meta-Learner**

### **1. Neural Network 개념**

Neural Network(신경망)은 다층 퍼셉트론(Multi-layer Perceptron, MLP)과 같은 구조를 갖는 모델로, 데이터에서 패턴을 학습하는 비선형 함수 근사기이다. 주요 구성 요소는 다음과 같다.

- **입력층(Input Layer)**: 데이터의 특징(feature)이 입력되는 층.
- **은닉층(Hidden Layers)**: 입력층과 출력층 사이의 층으로, 활성화 함수(Activation Function)를 사용해 비선형 변환을 수행.
- **출력층(Output Layer)**: 최종 예측값을 출력하는 층.

Neural Network는 가중치(Weight)와 편향(Bias)을 조정하여 학습하며, Backpropagation 알고리즘과 Gradient Descent 최적화를 활용해 성능을 향상시킨다.

---

### **2. Meta-Learner 개념**

Meta-Learning(메타 러닝)은 학습 알고리즘이 자체적으로 더 나은 학습을 수행할 수 있도록 돕는 기법이다. 일반적으로 **Few-shot Learning**이나 **Domain Adaptation** 같은 문제를 해결하기 위해 사용된다. Meta-Learner는 다음과 같은 주요 기능을 수행한다.

- **Task 간 일반화 능력 학습**: 모델이 새로운 태스크에도 빠르게 적응하도록 학습.
- **Hyperparameter Optimization**: 학습 과정에서 최적의 하이퍼파라미터를 자동으로 조정.
- **Adaptation Strategy**: 새로운 데이터 분포에 맞게 모델이 빠르게 적응하는 방법 학습.

---

## **3. Meta-Learner의 종류: T-Net, S-Net, S-Learner, T-Learner**

Meta-Learner는 주로 **처치 효과(치료 효과, Treatment Effect)를 추정**하는 분야에서 사용되며, 특히 Causal Inference(인과 추론)에서 중요한 역할을 한다. 대표적인 방법으로 **S-Learner, T-Learner, T-Net, S-Net**이 있다.

### **(1) T-Net, S-Net**

이 모델들은 Neural Network 기반으로 Treatment Effect를 추정하기 위한 신경망 구조이다.

#### **T-Net (Treatment Net)**

- 처치 변수(Treatment Variable)를 입력에 추가한 후, 뉴럴 네트워크가 전체적인 관계를 학습하는 구조.
- 하나의 네트워크에서 처치 유무에 따른 출력값을 함께 학습.
- **장점**: 단일 모델로 처리 가능하며, 데이터 샘플이 적을 때 강점.
- **단점**: 처치 효과가 매우 비선형일 경우 모델이 과적합될 가능성이 있음.

#### **S-Net (Selection Net)**

- 선택 편향(Selection Bias)을 보정하기 위해 학습된 Neural Network.
- 처치 여부를 예측하는 네트워크와 실제 효과를 추정하는 네트워크로 구성됨.
- 다양한 편향을 조정하는 데 강점이 있음.

---

### **(2) S-Learner & T-Learner**

T-Net과 S-Net이 Neural Network 기반이라면, S-Learner와 T-Learner는 보다 일반적인 머신러닝 기반 방법론이다.

#### **S-Learner (Single Learner)**

- **하나의 모델**을 사용하여 처치(Treatment)를 고려한 예측을 수행.
- 수식: $$\hat{Y} = f(X, T)$$ 여기서, X는 Feature, T는 Treatment Variable, ff는 학습된 모델.
- 같은 모델에서 처치가 적용되지 않았을 때( $T=0$ )와 적용되었을 때( $T=1$ )의 차이를 비교하여 처치 효과를 추정.
- **장점**: 단순한 모델링, 모든 데이터 사용 가능.
- **단점**: 처치 효과를 정확하게 추정하기 어려울 수 있음.

#### **T-Learner (Two Learners)**

- **두 개의 별도 모델**을 학습하여 처치 그룹과 비처치 그룹의 관계를 따로 모델링.
- 두 개의 예측 모델을 학습한 후, 두 모델 간의 예측 차이를 처치 효과로 추정.
- 수식:$$ \hat{Y}_0 = f_0(X), \quad \hat{Y}_1 = f_1(X)$$ 처치 효과 추정: $$\hat{\tau}(X) = \hat{Y}_1 - \hat{Y}_0$$
- **장점**: 개별적인 학습으로 더 강력한 추론 가능.
- **단점**: 데이터가 적으면 두 개의 모델을 학습하는 것이 어려울 수 있음.

---

## **4. 비교 정리**

|Model|특징|장점|단점|
|---|---|---|---|
|**T-Net**|Treatment을 직접 예측하는 Neural Network|단일 모델로 학습 가능|비선형 관계에서 과적합 가능|
|**S-Net**|Selection Bias 보정하는 Neural Network|Selection Bias 조정 가능|복잡한 모델 구조|
|**S-Learner**|하나의 모델로 처치 효과 추정|단순한 모델링|처치 효과 학습이 어려울 수 있음|
|**T-Learner**|두 개의 개별 모델로 처치 효과 추정|강력한 추론 가능|데이터 부족 시 학습 어려움|

---

## **5. 중요한 질문**

📌 **"If I were a professor" approach**

- S-Learner와 T-Learner를 각각 Neural Network로 확장하려면 어떤 방식이 효과적일까?

📌 **"Real-world application" approach**

- 실제 의료 연구에서 T-Learner와 S-Learner를 어떻게 적용할 수 있을까?

📌 **"Opposing perspective" approach**

- T-Learner보다 S-Learner를 선호해야 하는 상황은 어떤 경우일까?

📌 **"Graph/mathematical representation" approach**

- T-Learner의 수식을 일반적인 Neural Network 손실 함수와 비교하면 어떤 차이가 있을까?

![[[MLforRecSys] (10강) 인과성과 기계학습 II.pdf]]